<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>å‘å‘å‘å¨±ä¹ - æ¸¸æˆå¤§å…</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
:root{
  --bg:#071019; --card:#0b1220; --accent:#d48806; --accent-dark:#b36f00; --muted:#9aa3ad;
}
html,body{margin:0;padding:0;background:var(--bg);color:#fff;font-family:Arial;}
.wrap{max-width:780px;margin:auto;padding-bottom:90px;}
header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;background:rgba(255,255,255,0.03);border-bottom:1px solid rgba(255,255,255,0.06);}
header .left{display:flex;align-items:center;gap:10px;}
header img{width:44px;height:44px;border-radius:10px;border:2px solid rgba(255,215,0,0.25);}
header .title{font-size:18px;color:var(--accent);font-weight:bold;}
.header-right{display:flex;align-items:center;gap:10px}
.icon-btn{background:transparent;border:0;color:var(--muted);font-size:18px;cursor:pointer}

/* wallet */
.wallet{margin:14px 16px;padding:14px;border-radius:10px;background:linear-gradient(90deg,rgba(204,32,0,0.06),rgba(255,200,0,0.05));display:flex;align-items:center;justify-content:space-between;border:1px solid rgba(255,255,255,0.05);}
.balance-left .label{font-size:12px;color:var(--muted)}
.balance-left .amount{font-size:22px;color:var(--accent);font-weight:bold}
.actions{display:flex;gap:8px}
.btn{padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
.btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent-dark));color:#120800;font-weight:700}
.btn-ghost{background:rgba(255,255,255,0.06);color:#fff}

/* banner */
.banner{margin:10px 16px;height:160px;border-radius:12px;overflow:hidden;position:relative;}
.banner img{width:100%;height:100%;object-fit:cover;transition:opacity .6s}
.banner .text{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(180deg,rgba(0,0,0,0),rgba(0,0,0,.45));padding:10px;font-size:16px;font-weight:bold}
.dots{display:flex;gap:6px;justify-content:center;margin-top:8px}

/* categories */
.categories{display:grid;grid-template-columns:repeat(6,1fr);gap:12px;padding:10px 16px;}
.cat{background:rgba(255,255,255,0.05);border-radius:10px;text-align:center;padding:10px;font-size:12px;color:var(--muted);cursor:pointer}
.cat span{font-size:22px;display:block;margin-bottom:6px}

/* games */
.section-title{display:flex;justify-content:space-between;margin:10px 16px}
.section-title h3{margin:0;font-size:16px;color:var(--accent)}
.games{padding:0 16px;display:grid;grid-template-columns:1fr 1fr;gap:12px}
.game{background:rgba(255,255,255,0.04);border-radius:12px;overflow:hidden;position:relative;border:1px solid rgba(255,255,255,0.04)}
.game img{width:100%;height:110px;object-fit:cover}
.game .info{padding:8px;font-size:14px;font-weight:700}
.play{position:absolute;right:10px;bottom:10px;padding:6px 10px;border-radius:8px;background:var(--accent);color:#120800;font-weight:700;border:0}

/* modal */
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:50}
.modal{width:92%;max-width:520px;background:linear-gradient(180deg,#08101a,#06101a);border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.03)}
.modal-header{display:flex;justify-content:space-between;align-items:center}
.close{background:transparent;border:0;color:var(--muted);font-size:18px;cursor:pointer}
.form-row{display:flex;gap:8px;margin-top:8px}
.input{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#fff}

/* bottom nav */
.nav{position:fixed;left:0;right:0;bottom:0;height:60px;background:rgba(0,0,0,0.25);display:flex;justify-content:space-around;align-items:center;border-top:1px solid rgba(255,255,255,0.06)}
.nav button{background:transparent;border:0;color:var(--muted);font-size:13px}
.nav .active{color:var(--accent);font-weight:700}

/* small screens */
@media(max-width:420px){
  .banner{height:140px}
  .game img{height:100px}
}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="left">
      <img src="https://via.placeholder.com/44x44/ffcc00/8b0000?text=å‘" />
      <div>
        <div class="title">å‘å‘å‘å¨±ä¹</div>
        <div class="sub">æ¬¢è¿ Â· VIP</div>
      </div>
    </div>
    <div class="header-right">
      <div id="tg-status" style="font-size:12px;color:var(--muted)">Telegram: æœªæ£€æµ‹</div>
      <button class="icon-btn" id="open-settings">âš™ï¸</button>
    </div>
  </header>

  <!-- wallet -->
  <div class="wallet">
    <div class="balance-left">
      <div class="label">ä½™é¢</div>
      <div class="amount" id="balance">Â¥0.00</div>
      <div style="font-size:12px;color:var(--muted)" id="balance-note">ä¸Šæ¬¡æ›´æ–°ï¼š-</div>
    </div>
    <div class="actions">
      <button class="btn btn-primary" id="recharge-btn">å……å€¼</button>
      <button class="btn btn-ghost" id="withdraw-btn">æç°</button>
    </div>
  </div>

  <!-- banner (è‡ªåŠ¨è½®æ’­) -->
  <div class="banner" id="banner">
    <!-- å›¾ç‰‡é€šè¿‡ JS æ§åˆ¶ -->
  </div>
  <div class="dots" id="banner-dots" style="margin:0 16px 8px 16px;display:flex;justify-content:center"></div>

  <!-- categories -->
  <div class="categories" id="categories">
    <div class="cat" data-cat="hot"><span>ğŸ”¥</span>çƒ­é—¨</div>
    <div class="cat" data-cat="slots"><span>ğŸ°</span>è€è™æœº</div>
    <div class="cat" data-cat="mahjong"><span>ğŸ€„</span>éº»å°†</div>
    <div class="cat" data-cat="live"><span>ğŸ¥</span>çœŸäºº</div>
    <div class="cat" data-cat="lottery"><span>ğŸŸï¸</span>å½©ç¥¨</div>
    <div class="cat" data-cat="sports"><span>âš½</span>ä½“è‚²</div>
  </div>

  <div class="section-title">
    <h3>çƒ­é—¨æ¨è</h3>
    <button id="more-games">æ›´å¤š</button>
  </div>

  <div class="games" id="games">
    <!-- æ¸¸æˆå¡ç‰‡ç”± JS æ¸²æŸ“ -->
  </div>

</div>

<!-- modal: é€šç”¨ï¼ˆå……å€¼/æç°/è®¾ç½®ï¼‰ -->
<div class="modal-backdrop" id="modal-backdrop">
  <div class="modal" id="modal">
    <div class="modal-header">
      <div id="modal-title">æ ‡é¢˜</div>
      <button class="close" id="modal-close">âœ•</button>
    </div>
    <div id="modal-body" style="margin-top:10px"></div>
  </div>
</div>

<!-- bottom nav -->
<div class="nav">
  <button class="active">é¦–é¡µ</button>
  <button>æ¸¸æˆ</button>
  <button>ä»»åŠ¡</button>
  <button id="nav-wallet">é’±åŒ…</button>
  <button>æˆ‘çš„</button>
</div>

<script>
/* ========================
   é…ç½®ï¼ˆæ›¿æ¢æˆä½ çš„åç«¯åœ°å€ï¼‰
   ======================== */
const API_BASE = ""; // ä¾‹å¦‚ "https://api.yoursite.com"ï¼›ä¸ºç©ºè¡¨ç¤ºåŒåŸŸï¼ˆç›¸å¯¹è·¯å¾„ /api/...ï¼‰

/* ========== Banner æ•°æ® ========== */
const BANNERS = [
  {img:"https://via.placeholder.com/720x320/cc0000/fff?text=é¦–å……+ç¿»å€", text:"é¦–å……ç¿»å€ Â· æ—¥å¸¸è¿”æ°´"},
  {img:"https://via.placeholder.com/720x320/aa2200/fff?text=éº»å°†èƒ¡äº†", text:"æ–°æ¸¸ä¸Šçº¿ï¼šã€Šéº»å°†èƒ¡äº†ã€‹"},
  {img:"https://via.placeholder.com/720x320/bb4400/fff?text=é»„é‡‘æ—¶æ®µ", text:"é»„é‡‘æ—¶æ®µé€å¤§ç¤¼åŒ…"}
];

/* ========== æ¸¸æˆæ•°æ® ========== */
const GAMES = [
  {id:1,title:"Gates of Olympus", tag:"è€è™æœº", img:"https://via.placeholder.com/360x200/880000/ffd700?text=Gates+of+Olympus", url:"/games/gates.html"},
  {id:2,title:"éº»å°†èƒ¡äº† H5", tag:"æ£‹ç‰Œ", img:"https://via.placeholder.com/360x200/aa2200/fff?text=éº»å°†èƒ¡äº†", url:"/games/mahjong/index.html"},
  {id:3,title:"æ•é±¼è¾¾äºº", tag:"æ•é±¼", img:"https://via.placeholder.com/360x200/cc3300/fff?text=æ•é±¼è¾¾äºº", url:"/games/fish/index.html"}
];

/* ========== DOM å…ƒç´  ========== */
const bannerEl = document.getElementById("banner");
const dotsEl = document.getElementById("banner-dots");
const gamesEl = document.getElementById("games");
const balanceEl = document.getElementById("balance");
const balanceNoteEl = document.getElementById("balance-note");
const modalBackdrop = document.getElementById("modal-backdrop");
const modalTitle = document.getElementById("modal-title");
const modalBody = document.getElementById("modal-body");
const modalClose = document.getElementById("modal-close");
const openSettingsBtn = document.getElementById("open-settings");
const rechargeBtn = document.getElementById("recharge-btn");
const withdrawBtn = document.getElementById("withdraw-btn");

/* ========== Banner è½®æ’­é€»è¾‘ ========== */
let activeBanner = 0;
function renderBanner(){
  bannerEl.innerHTML = "";
  const b = BANNERS[activeBanner];
  const img = document.createElement("img");
  img.src = b.img;
  bannerEl.appendChild(img);
  const txt = document.createElement("div");
  txt.className = "text";
  txt.textContent = b.text;
  bannerEl.appendChild(txt);

  // dots
  dotsEl.innerHTML = "";
  BANNERS.forEach((_,i)=>{
    const d = document.createElement("button");
    d.style.width="8px"; d.style.height="8px"; d.style.borderRadius="999px"; d.style.border=0;
    d.style.background = i===activeBanner ? "var(--accent)" : "rgba(255,255,255,0.12)";
    d.style.margin="0 4px";
    d.onclick = ()=>{ activeBanner=i; renderBanner(); };
    dotsEl.appendChild(d);
  });
}
renderBanner();
setInterval(()=>{ activeBanner = (activeBanner+1)%BANNERS.length; renderBanner(); }, 4500);

/* ========== æ¸²æŸ“æ¸¸æˆå¡ç‰‡ ========== */
function renderGames(){
  gamesEl.innerHTML = "";
  GAMES.forEach(g=>{
    const card = document.createElement("div");
    card.className = "game";
    card.innerHTML = `<img src="${g.img}" alt="${g.title}" /><div class="info">${g.title}</div><button class="play">è¿›å…¥</button>`;
    card.querySelector(".play").onclick = ()=> openGame(g);
    card.onclick = (e)=>{ if(e.target.tagName!=="BUTTON") openGame(g); };
    gamesEl.appendChild(card);
  });
}
renderGames();

/* ========== æ‰“å¼€æ¸¸æˆé€»è¾‘ ==========
   å¦‚æœæ˜¯å†…éƒ¨ H5 æ¸¸æˆï¼Œç›´æ¥ location.hrefï¼›å¦‚éœ€åœ¨ TG WebApp å†…æ‰“å¼€ï¼Œä½¿ç”¨ Telegram.WebApp.openInline æˆ– window.open
================================== */
function openGame(g){
  // è¿™é‡Œç¤ºä¾‹ï¼šè‹¥æ˜¯ç›¸å¯¹è·¯å¾„åˆ™ç›´æ¥è·³è½¬ï¼›ç”Ÿäº§å¯å…ˆè¯·æ±‚åç«¯ç¡®è®¤ tokenï¼Œå†è·³è½¬
  const url = g.url;
  // ä¼˜å…ˆåœ¨æ–°çª—å£æ‰“å¼€ï¼ˆéƒ¨åˆ†å¹³å°å¯è¢« TG WebApp æ‹¦æˆªï¼‰
  window.open(url, "_blank");
}

/* ========== Modal æ§åˆ¶å‡½æ•° ========== */
function showModal(title, html){
  modalTitle.textContent = title;
  modalBody.innerHTML = html;
  modalBackdrop.style.display = "flex";
}
function hideModal(){ modalBackdrop.style.display = "none"; }
modalClose.onclick = hideModal;
modalBackdrop.onclick = (e)=>{ if(e.target===modalBackdrop) hideModal(); };

/* ========== ä½™é¢è¯»å–ï¼ˆè°ƒç”¨åç«¯æ¥å£ï¼‰ ========== */
async function fetchBalance(){
  try{
    const res = await fetch((API_BASE || "") + "/api/balance", {method:"GET", credentials:"include"});
    if(!res.ok) throw new Error("ä½™é¢æ¥å£è¿”å›é200");
    const data = await res.json();
    balanceEl.textContent = "Â¥" + (parseFloat(data.balance||0)).toFixed(2);
    const t = new Date().toLocaleTimeString();
    balanceNoteEl.textContent = "ä¸Šæ¬¡æ›´æ–°ï¼š" + t;
  }catch(err){
    console.error("fetchBalance err", err);
    balanceEl.textContent = "Â¥0.00";
    balanceNoteEl.textContent = "æ›´æ–°å¤±è´¥";
  }
}
fetchBalance(); // åˆæ¬¡è¯»å–

/* ========== å……å€¼å¼¹çª—ï¼ˆç¤ºä¾‹ï¼šè¯·æ±‚åç«¯ç”Ÿæˆå……å€¼è®¢å•ï¼‰ ========== */
rechargeBtn.onclick = ()=> {
  const html = `
    <div>
      <div style="font-size:13px;color:var(--muted)">è¯·è¾“å…¥å……å€¼é‡‘é¢</div>
      <div class="form-row"><input id="recharge-amt" class="input" placeholder="ä¾‹å¦‚ 100" type="number"/></div>
      <div style="margin-top:10px;text-align:right"><button id="do-recharge" class="btn btn-primary">åˆ›å»ºå……å€¼è®¢å•</button></div>
    </div>
  `;
  showModal("å……å€¼", html);
  document.getElementById("do-recharge").onclick = async ()=>{
    const amt = parseFloat(document.getElementById("recharge-amt").value);
    if(!amt || amt<=0){ alert("è¯·è¾“å…¥æ­£ç¡®é‡‘é¢"); return; }
    try{
      const res = await fetch((API_BASE || "") + "/api/recharge", {
        method:"POST", headers:{"Content-Type":"application/json"}, credentials:"include",
        body: JSON.stringify({amount: amt})
      });
      const j = await res.json();
      if(res.ok){
        alert("å……å€¼è®¢å•åˆ›å»ºæˆåŠŸï¼Œè®¢å•å·ï¼š" + j.orderId);
        hideModal();
        fetchBalance();
      }else{
        alert("å……å€¼å¤±è´¥ï¼š" + (j.message || res.status));
      }
    }catch(e){
      alert("å……å€¼è¯·æ±‚å¤±è´¥");
      console.error(e);
    }
  };
};

/* ========== æç°å¼¹çª—ï¼ˆç¤ºä¾‹ï¼‰ ========== */
withdrawBtn.onclick = ()=>{
  const html = `
    <div>
      <div style="font-size:13px;color:var(--muted)">æç°é‡‘é¢</div>
      <div class="form-row"><input id="withdraw-amt" class="input" placeholder="ä¾‹å¦‚ 200" type="number"/></div>
      <div style="font-size:12px;color:var(--muted);margin-top:6px">æ³¨æ„ï¼šæç°ä¼šåœ¨åå°å®¡æ ¸ï¼Œè¯·ç¡®ä¿è´¦æˆ·ä¿¡æ¯å®Œæ•´ã€‚</div>
      <div style="margin-top:10px;text-align:right"><button id="do-withdraw" class="btn btn-primary">ç”³è¯·æç°</button></div>
    </div>
  `;
  showModal("æç°", html);
  document.getElementById("do-withdraw").onclick = async ()=>{
    const amt = parseFloat(document.getElementById("withdraw-amt").value);
    if(!amt || amt<=0){ alert("è¯·è¾“å…¥æ­£ç¡®é‡‘é¢"); return; }
    try{
      const res = await fetch((API_BASE || "") + "/api/withdraw", {
        method:"POST", headers:{"Content-Type":"application/json"}, credentials:"include",
        body: JSON.stringify({amount: amt})
      });
      const j = await res.json();
      if(res.ok){
        alert("æç°ç”³è¯·å·²æäº¤ï¼Œæµæ°´å·ï¼š" + j.withdrawId);
        hideModal();
        fetchBalance();
      }else{
        alert("æç°å¤±è´¥ï¼š" + (j.message || res.status));
      }
    }catch(e){
      alert("æç°è¯·æ±‚å¤±è´¥");
      console.error(e);
    }
  };
};

/* ========== è®¾ç½®ï¼ˆç³»ç»Ÿè¯Šæ–­ï¼‰ ========== */
openSettingsBtn.onclick = async ()=>{
  // è°ƒç”¨åç«¯éªŒè¯ initDataï¼ˆç¤ºä¾‹ï¼‰
  let content = `<div style="font-size:13px;color:var(--muted)">æ£€æµ‹ Telegram ç¯å¢ƒ...</div>`;
  showModal("è®¾ç½® Â· ç³»ç»Ÿè¯Šæ–­", content);

  try{
    const res = await fetch((API_BASE || "") + "/api/verifyInitData", {method:"POST", credentials:"include"});
    const j = await res.json();
    const ok = res.ok;
    const html = `
      <div style="font-size:13px;color:${ok? '#7be495':'#ff7b7b'}">${ok? 'initData éªŒè¯é€šè¿‡':'initData éªŒè¯å¤±è´¥'}</div>
      <div style="margin-top:8px;font-size:13px;color:var(--muted)"><strong>ç»“æœï¼š</strong><pre style="white-space:pre-wrap">${JSON.stringify(j, null, 2)}</pre></div>
      <div style="text-align:right;margin-top:8px"><button id="close-ok" class="btn btn-ghost">å…³é—­</button></div>
    `;
    modalBody.innerHTML = html;
    document.getElementById("close-ok").onclick = hideModal;
  }catch(e){
    modalBody.innerHTML = `<div style="font-size:13px;color:#ff7b7b">æ£€æµ‹å¤±è´¥</div>`;
    console.error(e);
  }
};

/* ========== Telegram WebApp åˆå§‹åŒ–æ£€æµ‹ ========== */
if(window.Telegram && Telegram.WebApp){
  Telegram.WebApp.ready();
  document.getElementById("tg-status").textContent = "Telegram: å·²å°±ç»ª";
  // å¯è¯»å– initData å¹¶åŒæ­¥åˆ°åç«¯ï¼ˆç¤ºä¾‹ï¼‰
  try{
    const initData = Telegram.WebApp.initData || null;
    if(initData){
      // çœŸå®åœºæ™¯ï¼šæŠŠ initData å‘é€åˆ°åç«¯ /api/verifyInitData åšç­¾åæ ¡éªŒ
      // fetch("/api/verifyInitData", {method:"POST", body: initData})
    }
  }catch(e){}
}

/* ========== å®šæœŸåˆ·æ–°ä½™é¢ ========== */
setInterval(fetchBalance, 15_000); // æ¯15ç§’åˆ·æ–°ä¸€æ¬¡ï¼ˆä½ å¯æ”¹ï¼‰
</script>
</body>
</html>
