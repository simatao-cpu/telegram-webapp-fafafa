<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>发发发 CRM — Telegram WebApp</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#0f1724; color:#e6eef8; }
    .container { max-width:980px; margin:24px auto; padding:20px; }
    .card { background: rgba(255,255,255,0.06); padding:20px; border-radius:12px; }
    h1 { margin:0 0 10px 0; font-size:22px; }
    .btn { padding:12px 18px; border-radius:10px; background:#2563eb; color:#fff; border:none; margin-right:10px; }
    pre { background:rgba(255,255,255,0.08); padding:10px; border-radius:8px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>发发发 CRM — Telegram 小程序 Demo</h1>

      <button id="mainBtn" class="btn">显示主按钮</button>
      <button id="getUser" class="btn" style="background:#10b981">获取用户信息</button>

      <h3>用户数据：</h3>
      <pre id="userBox">尚未加载</pre>

      <button id="verifyBtn" class="btn" style="background:#dc2626">验证 initData</button>
      <pre id="verifyBox"></pre>
    </div>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    document.getElementById("mainBtn").onclick = () => {
      tg.MainButton.setText("主按钮已显示");
      tg.MainButton.show();
    };

    document.getElementById("getUser").onclick = () => {
      document.getElementById("userBox").innerText =
        JSON.stringify(tg.initDataUnsafe.user || {}, null, 2);
    };

    document.getElementById("verifyBtn").onclick = async () => {
      const initData = tg.initData;
      const res = await fetch('/api/verify', {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify({ initData })
      });
      const out = await res.json();
      document.getElementById("verifyBox").innerText =
        JSON.stringify(out, null, 2);
    };
  </script>
</body>
</html>
